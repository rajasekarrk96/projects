{% extends "base.html" %}

{% block title %}Edit Profile - ProConnect{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow-lg border-0">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <i class="fas fa-user-edit text-primary" style="font-size: 3rem;"></i>
                    <h2 class="mt-3">Edit Your Profile</h2>
                    <p class="text-muted">Update your professional information and preferences</p>
                </div>
                
                <form method="POST" enctype="multipart/form-data" id="editProfileForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="first_name" class="form-label">First Name *</label>
                                <input type="text" class="form-control" id="first_name" name="first_name" 
                                       value="{{ current_user.first_name }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="last_name" class="form-label">Last Name *</label>
                                <input type="text" class="form-control" id="last_name" name="last_name" 
                                       value="{{ current_user.last_name }}" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="bio" class="form-label">Bio</label>
                        <textarea class="form-control" id="bio" name="bio" rows="4" 
                                  placeholder="Tell us about yourself, your skills, and what you're passionate about...">{{ current_user.bio or '' }}</textarea>
                        <div class="form-text">Share your professional story and what makes you unique.</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="location" class="form-label">Location</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </span>
                                    <input type="text" class="form-control" id="location" name="location" 
                                           value="{{ current_user.location or '' }}" placeholder="City, Country">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="website" class="form-label">Website</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-globe"></i>
                                    </span>
                                    <input type="url" class="form-control" id="website" name="website" 
                                           value="{{ current_user.website or '' }}" placeholder="https://yourwebsite.com">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="profile_picture" class="form-label">Profile Picture</label>
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <div class="current-pic text-center">
                                    {% if current_user.profile_picture %}
                                        <img src="{{ url_for('static', filename='uploads/' + current_user.profile_picture) }}" 
                                             class="rounded-circle mb-2" width="80" height="80" alt="Current Profile Picture">
                                    {% else %}
                                        <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-2" 
                                             style="width: 80px; height: 80px;">
                                            <i class="fas fa-user text-white" style="font-size: 2rem;"></i>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-9">
                                <input type="file" class="form-control" id="profile_picture" name="profile_picture" accept="image/*">
                                <div class="form-text">Upload a professional photo (JPG, PNG, GIF - max 5MB)</div>
                            </div>
                        </div>
                    </div>
                    
                    {% if current_user.is_company %}
                    <div class="mb-4">
                        <h5 class="mb-3"><i class="fas fa-building me-2"></i>Company Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="company_name" class="form-label">Company Name</label>
                                    <input type="text" class="form-control" id="company_name" name="company_name" 
                                           value="{{ current_user.company_name or '' }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="company_description" class="form-label">Company Description</label>
                                    <textarea class="form-control" id="company_description" name="company_description" rows="3" 
                                              placeholder="Tell us about your company...">{{ current_user.company_description or '' }}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="d-flex gap-3 justify-content-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save me-2"></i>Save Changes
                        </button>
                        <a href="{{ url_for('profile', username=current_user.username) }}" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const editProfileForm = document.getElementById('editProfileForm');
    const profilePicture = document.getElementById('profile_picture');
    
    // File size validation
    profilePicture.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const fileSize = file.size / 1024 / 1024; // Convert to MB
            if (fileSize > 5) {
                alert('File size must be less than 5MB');
                this.value = '';
                return;
            }
            
            // File type validation
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            if (!allowedTypes.includes(file.type)) {
                alert('Please select a valid image file (JPG, PNG, GIF)');
                this.value = '';
                return;
            }
        }
    });
    
    // Form validation
    editProfileForm.addEventListener('submit', function(e) {
        const firstName = document.getElementById('first_name').value.trim();
        const lastName = document.getElementById('last_name').value.trim();
        
        if (!firstName || !lastName) {
            e.preventDefault();
            alert('Please fill in all required fields');
            return false;
        }
        
        // Website URL validation
        const website = document.getElementById('website').value.trim();
        if (website && !isValidUrl(website)) {
            e.preventDefault();
            alert('Please enter a valid website URL');
            return false;
        }
    });
    
    function isValidUrl(string) {
        try {
            new URL(string);
            return true;
        } catch (_) {
            return false;
        }
    }
    
    // Preview image before upload
    profilePicture.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const currentPic = document.querySelector('.current-pic img');
                if (currentPic) {
                    currentPic.src = e.target.result;
                } else {
                    const newImg = document.createElement('img');
                    newImg.src = e.target.result;
                    newImg.className = 'rounded-circle mb-2';
                    newImg.width = 80;
                    newImg.height = 80;
                    newImg.alt = 'Profile Picture Preview';
                    
                    const currentPicDiv = document.querySelector('.current-pic');
                    currentPicDiv.innerHTML = '';
                    currentPicDiv.appendChild(newImg);
                }
            };
            reader.readAsDataURL(file);
        }
    });
});
</script>
{% endblock %} 