<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Solar Tracker - Portfolio Demo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #1a1f2e;
      --bg-card: rgba(26, 31, 46, 0.8);
      --text-primary: #ffffff;
      --text-secondary: #b8c5d1;
      --accent-primary: #00d4ff;
      --accent-secondary: #ff6b35;
      --accent-success: #00ff88;
      --accent-warning: #ffb800;
      --accent-danger: #ff4757;
      --border-color: rgba(255, 255, 255, 0.1);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --glow: 0 0 20px rgba(0, 212, 255, 0.3);
    }
    
    [data-theme="light"] {
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-card: rgba(255, 255, 255, 0.9);
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --accent-primary: #3182ce;
      --accent-secondary: #ed8936;
      --accent-success: #38a169;
      --accent-warning: #d69e2e;
      --accent-danger: #e53e3e;
      --border-color: rgba(0, 0, 0, 0.1);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --glow: 0 0 20px rgba(49, 130, 206, 0.2);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      transition: all 0.3s ease;
      overflow-x: hidden;
    }
    
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }
    
    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--accent-primary);
      border-radius: 50%;
      animation: float 6s ease-in-out infinite;
      opacity: 0.6;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 2;
    }
    
    .header {
      text-align: center;
      padding: 40px 0;
      position: relative;
    }
    
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      border-radius: 50px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .theme-toggle:hover {
      box-shadow: var(--glow);
      transform: scale(1.05);
    }
    
    .theme-toggle i {
      font-size: 1.2rem;
      color: var(--accent-primary);
      transition: all 0.3s ease;
    }
    
    .title {
      font-size: 3.5rem;
      font-weight: 700;
      background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 10px;
      animation: titleGlow 2s ease-in-out infinite alternate;
    }
    
    @keyframes titleGlow {
      from { filter: drop-shadow(0 0 10px var(--accent-primary)); }
      to { filter: drop-shadow(0 0 20px var(--accent-secondary)); }
    }
    
    .subtitle {
      font-size: 1.2rem;
      color: var(--text-secondary);
      margin-bottom: 30px;
    }
    
    .dashboard {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 768px) {
      .dashboard { grid-template-columns: 1fr; }
    }
    
    .card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s;
    }
    
    .card:hover::before {
      left: 100%;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--glow);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .card-header i {
      font-size: 1.5rem;
      margin-right: 15px;
      color: var(--accent-primary);
    }
    
    .card-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .solar-viz {
      position: relative;
      height: 300px;
      background: radial-gradient(circle at center, var(--accent-warning) 0%, transparent 70%);
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .sun {
      position: absolute;
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, #ffeb3b, #ff9800);
      border-radius: 50%;
      box-shadow: 0 0 30px #ffeb3b;
      transition: all 0.5s ease;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .panel-model {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 40px;
      background: linear-gradient(45deg, #2196f3, #03a9f4);
      border-radius: 5px;
      transition: all 0.5s ease;
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    }
    
    .controls-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .control-btn {
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 15px;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      position: relative;
      overflow: hidden;
    }
    
    .control-btn:hover {
      background: var(--accent-primary);
      color: white;
      transform: scale(1.05);
      box-shadow: var(--glow);
    }
    
    .control-btn:active {
      transform: scale(0.95);
    }
    
    .control-btn i {
      margin-right: 8px;
    }
    
    .status-display {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid var(--accent-success);
    }
    
    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .status-item:last-child {
      margin-bottom: 0;
    }
    
    .status-value {
      font-weight: 600;
      color: var(--accent-primary);
    }
    
    .toggle-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background: var(--bg-secondary);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid var(--border-color);
    }
    
    .toggle-switch.active {
      background: var(--accent-success);
    }
    
    .toggle-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .toggle-switch.active .toggle-slider {
      transform: translateX(28px);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .stat-card {
      background: var(--bg-card);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--glow);
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 5px;
    }
    
    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      transform: translateX(400px);
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.success {
      border-left: 4px solid var(--accent-success);
    }
    
    .toast.error {
      border-left: 4px solid var(--accent-danger);
    }
    
    .toast.warning {
      border-left: 4px solid var(--accent-warning);
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  
  <div class="container">
    <div class="header">
      <div class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon" id="themeIcon"></i>
      </div>
      <h1 class="title">Smart Solar Tracker</h1>
      <p class="subtitle">IoT-Powered Solar Panel Optimization System</p>
    </div>
    
    <div class="dashboard">
      <div class="card">
        <div class="card-header">
          <i class="fas fa-sun"></i>
          <span class="card-title">Solar Position Tracker</span>
        </div>
        <div class="solar-viz">
          <div class="sun" id="sun"></div>
          <div class="panel-model" id="panel"></div>
        </div>
        <div class="status-display">
          <div class="status-item">
            <span>Azimuth:</span>
            <span class="status-value" id="azimuthValue">0°</span>
          </div>
          <div class="status-item">
            <span>Elevation:</span>
            <span class="status-value" id="elevationValue">0°</span>
          </div>
          <div class="status-item">
            <span>Panel Angle:</span>
            <span class="status-value" id="panelAngle">0°</span>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <i class="fas fa-cogs"></i>
          <span class="card-title">Control Panel</span>
        </div>
        <div class="status-item" style="margin-bottom: 20px;">
          <span>Auto Tracking:</span>
          <div class="toggle-switch" id="autoToggle" onclick="toggleAutoTracking()">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="controls-grid">
          <div class="control-btn" onclick="manualControl('north')">
            <i class="fas fa-arrow-up"></i> North
          </div>
          <div class="control-btn" onclick="manualControl('east')">
            <i class="fas fa-arrow-right"></i> East
          </div>
          <div class="control-btn" onclick="manualControl('south')">
            <i class="fas fa-arrow-down"></i> South
          </div>
          <div class="control-btn" onclick="manualControl('west')">
            <i class="fas fa-arrow-left"></i> West
          </div>
          <div class="control-btn" onclick="resetPanel()">
            <i class="fas fa-home"></i> Reset
          </div>
          <div class="control-btn" onclick="cleanPanel()">
            <i class="fas fa-broom"></i> Clean
          </div>
        </div>
      </div>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="efficiency">87%</div>
        <div class="stat-label">Efficiency</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="powerOutput">2.4kW</div>
        <div class="stat-label">Power Output</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="dailyEnergy">18.7kWh</div>
        <div class="stat-label">Daily Energy</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="uptime">99.2%</div>
        <div class="stat-label">System Uptime</div>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast">
    <span id="toastMessage"></span>
  </div>
  
  <script>
    let autoTracking = false;
    let trackingInterval;
    
    // Theme Management
    function toggleTheme() {
      const body = document.body;
      const themeIcon = document.getElementById('themeIcon');
      
      if (body.getAttribute('data-theme') === 'light') {
        body.removeAttribute('data-theme');
        themeIcon.className = 'fas fa-moon';
        showToast('Switched to Dark Mode', 'success');
      } else {
        body.setAttribute('data-theme', 'light');
        themeIcon.className = 'fas fa-sun';
        showToast('Switched to Light Mode', 'success');
      }
    }
    
    // Particle System
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      const particleCount = 50;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 6 + 's';
        particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
        particlesContainer.appendChild(particle);
      }
    }
    
    // Auto Tracking
    function toggleAutoTracking() {
      const toggle = document.getElementById('autoToggle');
      autoTracking = !autoTracking;
      
      if (autoTracking) {
        toggle.classList.add('active');
        startAutoTracking();
        showToast('Auto tracking enabled', 'success');
      } else {
        toggle.classList.remove('active');
        stopAutoTracking();
        showToast('Auto tracking disabled', 'warning');
      }
    }
    
    function startAutoTracking() {
      trackingInterval = setInterval(() => {
        updateSolarPosition();
      }, 5000);
      updateSolarPosition();
    }
    
    function stopAutoTracking() {
      if (trackingInterval) {
        clearInterval(trackingInterval);
      }
    }
    
    function updateSolarPosition() {
      const now = new Date();
      const lat = 40.7128; // Default to NYC
      const lng = -74.0060;
      
      const sunPosition = SunCalc.getPosition(now, lat, lng);
      const azimuth = (sunPosition.azimuth * 180 / Math.PI + 180) % 360;
      const elevation = sunPosition.altitude * 180 / Math.PI;
      
      document.getElementById('azimuthValue').textContent = azimuth.toFixed(1) + '°';
      document.getElementById('elevationValue').textContent = elevation.toFixed(1) + '°';
      
      // Update visual elements
      updateSunVisualization(azimuth, elevation);
      
      // Send to backend if tracking is enabled
      if (autoTracking && elevation > 0) {
        sendTrackingData(azimuth, elevation);
      }
    }
    
    function updateSunVisualization(azimuth, elevation) {
      const sun = document.getElementById('sun');
      const panel = document.getElementById('panel');
      
      // Position sun based on azimuth and elevation
      const x = (azimuth / 360) * 100;
      const y = Math.max(10, 90 - (elevation / 90) * 80);
      
      sun.style.left = x + '%';
      sun.style.top = y + '%';
      
      // Rotate panel to follow sun
      if (elevation > 0 && azimuth >= 75 && azimuth <= 105) {
        const panelAngle = ((azimuth - 75) / 30) * 180;
        panel.style.transform = `translateX(-50%) rotate(${panelAngle}deg)`;
        document.getElementById('panelAngle').textContent = panelAngle.toFixed(1) + '°';
      }
    }
    
    function sendTrackingData(azimuth, elevation) {
      fetch('/track_sun', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          azimuth: azimuth,
          elevation: elevation,
          timestamp: new Date().toISOString()
        })
      })
      .then(response => response.json())
      .then(data => {
        console.log('Tracking response:', data);
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('Connection error', 'error');
      });
    }
    
    // Manual Controls
    function manualControl(direction) {
      fetch('/manual_control', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ direction: direction })
      })
      .then(response => response.json())
      .then(data => {
        showToast(`Moved ${direction}`, 'success');
      })
      .catch(error => {
        showToast('Control failed', 'error');
      });
    }
    
    function resetPanel() {
      fetch('/manual_control', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ direction: 'reset' })
      })
      .then(() => {
        document.getElementById('panel').style.transform = 'translateX(-50%) rotate(0deg)';
        document.getElementById('panelAngle').textContent = '0°';
        showToast('Panel reset to home position', 'success');
      })
      .catch(() => {
        showToast('Reset failed', 'error');
      });
    }
    
    function cleanPanel() {
      fetch('/clean', {
        method: 'POST'
      })
      .then(() => {
        showToast('Panel cleaning initiated', 'success');
        // Animate cleaning effect
        const panel = document.getElementById('panel');
        panel.style.filter = 'brightness(1.3)';
        setTimeout(() => {
          panel.style.filter = 'brightness(1)';
        }, 2000);
      })
      .catch(() => {
        showToast('Cleaning failed', 'error');
      });
    }
    
    // Toast Notifications
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      
      toastMessage.textContent = message;
      toast.className = `toast ${type} show`;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // Simulate real-time stats updates
    function updateStats() {
      const efficiency = document.getElementById('efficiency');
      const powerOutput = document.getElementById('powerOutput');
      const dailyEnergy = document.getElementById('dailyEnergy');
      const uptime = document.getElementById('uptime');
      
      // Simulate fluctuating values
      efficiency.textContent = (85 + Math.random() * 10).toFixed(1) + '%';
      powerOutput.textContent = (2.0 + Math.random() * 1.0).toFixed(1) + 'kW';
      dailyEnergy.textContent = (15 + Math.random() * 8).toFixed(1) + 'kWh';
      uptime.textContent = (98 + Math.random() * 2).toFixed(1) + '%';
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      createParticles();
      updateSolarPosition();
      setInterval(updateStats, 3000);
      showToast('Solar Tracker System Online', 'success');
    });
  </script>
</body>
</html>
